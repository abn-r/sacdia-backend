generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model activities {
  activity_id     Int                @id @default(autoincrement())
  name            String             @db.VarChar(80)
  description     String?
  club_type_id    Int
  active          Boolean            @default(false)
  lat             Float
  long            Float
  activity_time   String             @default("09:00") @db.VarChar(10)
  activity_place  String             @default("place")
  image           String
  platform        Int                @default(0)
  activity_type   Int                @default(0)
  link_meet       String?
  additional_data String?
  attendees       Json?              @db.Json
  classes         Json?              @db.Json
  created_by      String             @db.Uuid
  created_at      DateTime?          @db.Timestamptz(6)
  modified_at     DateTime?          @db.Timestamptz(6)
  club_adv_id     Int
  club_mg_id      Int
  club_pathf_id   Int
  club_adv_i      club_adventurers   @relation(fields: [club_adv_id], references: [club_adv_id], onDelete: NoAction, onUpdate: NoAction)
  club_mg         club_master_guilds @relation(fields: [club_mg_id], references: [club_mg_id], onDelete: NoAction, onUpdate: NoAction)
  club_pathf      club_pathfinders   @relation(fields: [club_pathf_id], references: [club_pathf_id], onDelete: NoAction, onUpdate: NoAction)
  club_types      club_types         @relation(fields: [club_type_id], references: [club_type_id], onDelete: NoAction, onUpdate: NoAction)
  users           users              @relation(fields: [created_by], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
}

model folder_assignments {
  folder_assignment_id Int       @id @default(autoincrement())
  folder_id            Int?
  active               Boolean   @default(true)
  assignment_date      DateTime? @default(now()) @db.Timestamptz(6)
  created_at           DateTime  @default(now()) @db.Timestamptz(6)
  modified_at          DateTime? @default(now()) @db.Timestamptz(6)
  user_id              String?   @db.Uuid
  folders              folders?  @relation(fields: [folder_id], references: [folder_id], onDelete: NoAction, onUpdate: NoAction)
  users                users?    @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_assignments_folders_users_user_id")
}

model camporee_clubs {
  camporee_club_id Int                 @id @default(autoincrement())
  camporee_id      Int
  camporee_type    String              @db.VarChar(50)
  club_id          Int?
  local_field_id   Int?
  active           Boolean             @default(true)
  created_at       DateTime            @default(now()) @db.Timestamptz(6)
  modified_at      DateTime            @default(now()) @db.Timestamptz(6)
  club_adv_id      Int?
  club_mg_id       Int?
  club_pathf_id    Int?
  local_camporees  local_camporees     @relation(fields: [camporee_id], references: [local_camporee_id], onDelete: Cascade, onUpdate: NoAction)
  club_adv         club_adventurers?   @relation(fields: [club_adv_id], references: [club_adv_id], onDelete: NoAction, onUpdate: NoAction)
  club_mg          club_master_guilds? @relation(fields: [club_mg_id], references: [club_mg_id], onDelete: NoAction, onUpdate: NoAction)
  club_pathf       club_pathfinders?   @relation(fields: [club_pathf_id], references: [club_pathf_id], onDelete: NoAction, onUpdate: NoAction)
  local_fields     local_fields?       @relation(fields: [local_field_id], references: [local_field_id], onDelete: Cascade, onUpdate: NoAction)
}

model camporee_members {
  camporee_member_id Int      @id @default(autoincrement())
  camporee_id        Int
  camporee_type      String   @db.VarChar(50)
  user_id            String   @db.Uuid
  club_name          String?  @db.VarChar(255)
  local_field_id     Int?
  insurance_verified Boolean  @default(false)
  insurance_id       Int?
  active             Boolean  @default(true)
  created_at         DateTime @default(now()) @db.Timestamptz(6)
  modified_at        DateTime @default(now()) @db.Timestamptz(6)

  local_camporees local_camporees    @relation(fields: [camporee_id], references: [local_camporee_id], onDelete: Cascade, onUpdate: NoAction)
  local_fields    local_fields?      @relation(fields: [local_field_id], references: [local_field_id], onDelete: Cascade, onUpdate: NoAction)
  users           users              @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
  insurance       member_insurances? @relation(fields: [insurance_id], references: [insurance_id], onDelete: NoAction, onUpdate: NoAction)
}

model churches {
  church_id          Int       @id @default(autoincrement())
  name               String    @db.VarChar(50)
  active             Boolean   @default(false)
  districlub_type_id Int
  created_at         DateTime? @default(now()) @db.Timestamptz(6)
  modified_at        DateTime? @default(now()) @db.Timestamptz(6)
  districts          districts @relation(fields: [districlub_type_id], references: [districlub_type_id], onDelete: NoAction, onUpdate: NoAction)
  clubs              clubs[]
}

model class_module_progress {
  module_progress_id Int      @id @default(autoincrement())
  user_id            String   @db.Uuid
  class_id           Int
  module_id          Int
  score              Float
  active             Boolean  @default(true)
  created_at         DateTime @default(now()) @db.Timestamptz(6)
  modified_at        DateTime @default(now()) @db.Timestamptz(6)
  classes            classes  @relation(fields: [class_id], references: [class_id], onDelete: NoAction, onUpdate: NoAction)
  users              users    @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([user_id, class_id, module_id])
}

model class_modules {
  module_id      Int              @id @default(autoincrement())
  name           String           @db.VarChar(255)
  description    String?
  class_id       Int
  active         Boolean
  created_at     DateTime         @default(now()) @db.Timestamptz(6)
  modified_at    DateTime         @default(now()) @db.Timestamptz(6)
  classes        classes          @relation(fields: [class_id], references: [class_id], onDelete: NoAction, onUpdate: NoAction)
  class_sections class_sections[]

  @@unique([name, class_id])
}

model class_section_progress {
  section_progress_id Int      @id @default(autoincrement())
  user_id             String   @db.Uuid
  class_id            Int
  module_id           Int
  section_id          Int
  score               Float
  evidences           Json?
  active              Boolean  @default(true)
  created_at          DateTime @default(now()) @db.Timestamptz(6)
  modified_at         DateTime @default(now()) @db.Timestamptz(6)
  classes             classes  @relation(fields: [class_id], references: [class_id], onDelete: NoAction, onUpdate: NoAction)
  users               users    @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([user_id, class_id, module_id, section_id])
}

model class_sections {
  section_id    Int           @id @default(autoincrement())
  name          String        @db.VarChar(255)
  description   String?
  module_id     Int
  active        Boolean
  created_at    DateTime      @default(now()) @db.Timestamptz(6)
  modified_at   DateTime      @default(now()) @db.Timestamptz(6)
  class_modules class_modules @relation(fields: [module_id], references: [module_id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([name, module_id])
}

model classes {
  class_id               Int                      @id @default(autoincrement())
  name                   String                   @unique @db.VarChar(255)
  description            String?
  active                 Boolean
  club_type_id           Int
  minimum_age            Int
  requires_invested_gm   Boolean                  @default(false)
  created_at             DateTime                 @default(now()) @db.Timestamptz(6)
  modified_at            DateTime                 @default(now()) @db.Timestamptz(6)
  material_url           String?                  @db.VarChar
  class_module_progress  class_module_progress[]
  class_modules          class_modules[]
  class_section_progress class_section_progress[]
  club_types             club_types               @relation(fields: [club_type_id], references: [club_type_id], onDelete: NoAction, onUpdate: NoAction)
  enrollments            enrollments[]
  users_classes          users_classes[]
}

model club_ideals {
  club_ideal_id Int        @id @default(autoincrement())
  name          String     @db.VarChar(50)
  ideal_order   Int
  club_type_id  Int
  active        Boolean    @default(false)
  created_at    DateTime?  @default(now()) @db.Timestamptz(6)
  modified_at   DateTime?  @default(now()) @db.Timestamptz(6)
  ideal         String?
  club_types    club_types @relation(fields: [club_type_id], references: [club_type_id], onDelete: NoAction, onUpdate: NoAction)
}

model club_inventory {
  club_inventory_id     Int                 @id @default(autoincrement())
  name                  String              @db.VarChar(100)
  description           String?
  inventory_category_id Int?
  amount                Int?                @default(0)
  active                Boolean             @default(false)
  created_at            DateTime?           @default(now()) @db.Timestamptz(6)
  modified_at           DateTime?           @default(now()) @db.Timestamptz(6)
  club_adv_id           Int?
  club_mg_id            Int?
  club_pathf_id         Int?
  club_adventurers      club_adventurers?   @relation(fields: [club_adv_id], references: [club_adv_id])
  club_master_guild     club_master_guilds? @relation(fields: [club_mg_id], references: [club_mg_id])
  club_pathfinders      club_pathfinders?   @relation(fields: [club_pathf_id], references: [club_pathf_id])
}

model club_types {
  club_type_id      Int                  @id @default(autoincrement())
  name              String               @unique @db.VarChar(50)
  active            Boolean              @default(false)
  created_at        DateTime?            @default(now()) @db.Timestamptz(6)
  modified_at       DateTime?            @default(now()) @db.Timestamptz(6)
  activities        activities[]
  classes           classes[]
  club_adventurers  club_adventurers[]
  club_ideals       club_ideals[]
  club_master_guild club_master_guilds[]
  club_pathfinders  club_pathfinders[]
  finances          finances[]
  folders           folders[]
  honors            honors[]
  units             units[]
}

model clubs {
  club_id            Int                  @id @default(autoincrement())
  name               String               @db.VarChar(50)
  description        String?
  active             Boolean              @default(false)
  local_field_id     Int
  address            String?
  districlub_type_id Int
  church_id          Int
  coordinates        Json                 @db.Json
  created_at         DateTime?            @default(now()) @db.Timestamptz(6)
  modified_at        DateTime?            @default(now()) @db.Timestamptz(6)
  club_adventurers   club_adventurers[]
  club_master_guild  club_master_guilds[]
  club_pathfinders   club_pathfinders[]
  churches           churches             @relation(fields: [church_id], references: [church_id], onDelete: NoAction, onUpdate: NoAction)
  districts          districts            @relation(fields: [districlub_type_id], references: [districlub_type_id], onDelete: NoAction, onUpdate: NoAction)
  local_fields       local_fields         @relation(fields: [local_field_id], references: [local_field_id], onDelete: NoAction, onUpdate: NoAction)
}

model club_adventurers {
  club_adv_id               Int                       @id @default(autoincrement())
  active                    Boolean                   @default(false)
  souls_target              Int                       @default(1)
  fee                       Int                       @default(1)
  meeting_day               Json[]                    @db.Json
  meeting_time              Json[]                    @db.Json
  club_type_id              Int
  created_at                DateTime                  @default(now()) @db.Timestamptz(6)
  modified_at               DateTime                  @default(now()) @updatedAt @db.Timestamptz(6)
  main_club_id              Int?
  activities                activities[]
  attending_clubs_camporees camporee_clubs[]
  club_types                club_types                @relation(fields: [club_type_id], references: [club_type_id])
  clubs                     clubs?                    @relation(fields: [main_club_id], references: [club_id], onDelete: Cascade, onUpdate: NoAction)
  club_inventory            club_inventory[]
  club_role_assignments     club_role_assignments[]
  finances                  finances[]
  folders_modules_records   folders_modules_records[]
  folders_section_records   folders_section_records[]
  units                     units[]
}

model club_pathfinders {
  club_pathf_id             Int                       @id @default(autoincrement())
  active                    Boolean                   @default(false)
  souls_target              Int                       @default(1)
  fee                       Int                       @default(1)
  meeting_day               Json[]                    @db.Json
  meeting_time              Json[]                    @db.Json
  club_type_id              Int
  created_at                DateTime                  @default(now()) @db.Timestamptz(6)
  modified_at               DateTime                  @default(now()) @updatedAt @db.Timestamptz(6)
  main_club_id              Int?
  activities                activities[]
  attending_clubs_camporees camporee_clubs[]
  club_inventory            club_inventory[]
  club_types                club_types                @relation(fields: [club_type_id], references: [club_type_id])
  clubs                     clubs?                    @relation(fields: [main_club_id], references: [club_id], onDelete: Cascade, onUpdate: NoAction)
  club_role_assignments     club_role_assignments[]
  finances                  finances[]
  folders_modules_records   folders_modules_records[]
  folders_section_records   folders_section_records[]
  units                     units[]
}

model club_master_guilds {
  club_mg_id                Int                       @id @default(autoincrement())
  active                    Boolean                   @default(false)
  souls_target              Int                       @default(1)
  fee                       Int                       @default(1)
  meeting_day               Json[]                    @db.Json
  meeting_time              Json[]                    @db.Json
  club_type_id              Int
  created_at                DateTime                  @default(now()) @db.Timestamptz(6)
  modified_at               DateTime                  @default(now()) @updatedAt @db.Timestamptz(6)
  main_club_id              Int?
  activities                activities[]
  attending_clubs_camporees camporee_clubs[]
  club_inventory            club_inventory[]
  club_types                club_types                @relation(fields: [club_type_id], references: [club_type_id], onDelete: NoAction, onUpdate: NoAction)
  clubs                     clubs?                    @relation(fields: [main_club_id], references: [club_id], onDelete: Cascade, onUpdate: NoAction)
  club_role_assignments     club_role_assignments[]
  finances                  finances[]
  folders_modules_records   folders_modules_records[]
  folders_section_records   folders_section_records[]
  units                     units[]
}

model club_role_assignments {
  assignment_id          String               @id @default(dbgenerated("extensions.uuid_generate_v4()")) @db.Uuid
  user_id                String               @db.Uuid
  role_id                String               @db.Uuid
  club_adv_id            Int?
  club_pathf_id          Int?
  club_mg_id             Int?
  ecclesiastical_year_id Int
  start_date             DateTime             @db.Date
  end_date               DateTime?            @db.Date
  active                 Boolean              @default(true)
  status                 String?              @default("active") @db.VarChar(20)
  created_at             DateTime             @default(now()) @db.Timestamptz(6)
  modified_at            DateTime             @default(now()) @updatedAt @db.Timestamptz(6)
  club_adventurers       club_adventurers?    @relation(fields: [club_adv_id], references: [club_adv_id], onDelete: Cascade, onUpdate: NoAction)
  club_master_guild      club_master_guilds?  @relation(fields: [club_mg_id], references: [club_mg_id], onDelete: Cascade, onUpdate: NoAction)
  club_pathfinders       club_pathfinders?    @relation(fields: [club_pathf_id], references: [club_pathf_id], onDelete: Cascade, onUpdate: NoAction)
  ecclesiastical_year    ecclesiastical_years @relation(fields: [ecclesiastical_year_id], references: [year_id], onDelete: Cascade, onUpdate: NoAction)
  roles                  roles                @relation(fields: [role_id], references: [role_id], onDelete: Cascade, onUpdate: NoAction)
  users                  users                @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, role_id, club_adv_id, club_pathf_id, club_mg_id, ecclesiastical_year_id, start_date], map: "club_role_assignment_unique")
  @@unique([user_id, role_id, club_adv_id, club_pathf_id, club_mg_id, ecclesiastical_year_id, start_date], map: "club_role_assignment_unique_refactored")
  @@index([club_adv_id], map: "idx_club_role_assignments_club_adv")
  @@index([club_mg_id], map: "idx_club_role_assignments_club_mg")
  @@index([club_pathf_id], map: "idx_club_role_assignments_club_pathf")
  @@index([role_id], map: "idx_club_role_assignments_role")
  @@index([user_id], map: "idx_club_role_assignments_user")
  @@index([ecclesiastical_year_id], map: "idx_club_role_assignments_year")
}

model countries {
  country_id   Int       @id @default(autoincrement())
  name         String    @unique @db.VarChar(50)
  abbreviation String    @unique @db.VarChar(8)
  active       Boolean   @default(false)
  created_at   DateTime? @default(now()) @db.Timestamptz(6)
  modified_at  DateTime? @default(now()) @db.Timestamptz(6)
  unions       unions[]
  users        users[]

  @@index([active])
}

model districts {
  districlub_type_id Int          @id @default(autoincrement())
  name               String       @db.VarChar(50)
  active             Boolean      @default(false)
  local_field_id     Int
  created_at         DateTime?    @default(now()) @db.Timestamptz(6)
  modified_at        DateTime?    @default(now()) @db.Timestamptz(6)
  churches           churches[]
  clubs              clubs[]
  local_fields       local_fields @relation(fields: [local_field_id], references: [local_field_id], onDelete: NoAction, onUpdate: NoAction)
}

model ecclesiastical_years {
  year_id                  Int                     @id @default(autoincrement())
  start_date               DateTime                @db.Date
  end_date                 DateTime                @db.Date
  active                   Boolean                 @default(false)
  created_at               DateTime?               @default(now()) @db.Timestamptz(6)
  modified_at              DateTime?               @default(now()) @db.Timestamptz(6)
  club_role_assignments    club_role_assignments[]
  folders                  folders[]
  local_camporees_relation local_camporees[]       @relation("local_camporees_ecclesiastical_yearToecclesiastical_year")
  union_camporees_relation union_camporees[]       @relation("union_camporees_ecclesiastical_yearToecclesiastical_year")
  enrollments_relation     enrollments[]
  investiture_configs      investiture_config[]
}

model enrollments {
  enrollment_id          Int      @id @default(autoincrement())
  user_id                String   @db.Uuid
  class_id               Int
  ecclesiastical_year_id Int
  enrollment_date        DateTime @default(now()) @db.Timestamptz(6)

  // Estados de investidura
  investiture_status       investiture_status_enum @default(IN_PROGRESS)
  submitted_for_validation Boolean                 @default(false)
  submitted_at             DateTime?               @db.Timestamptz(6)
  validated_by             String?                 @db.Uuid
  validated_at             DateTime?               @db.Timestamptz(6)
  rejection_reason         String?
  investiture_date         DateTime?               @db.Timestamptz(6)

  // Estado avanzado
  advanced_status Boolean? @default(false)

  // Control de edici√≥n
  locked_for_validation Boolean @default(false)

  // Cursado cruzado
  cross_type_enrollment Boolean @default(false)

  active      Boolean  @default(true)
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  modified_at DateTime @default(now()) @db.Timestamptz(6)

  // Relations
  classes             classes              @relation(fields: [class_id], references: [class_id], onDelete: NoAction, onUpdate: NoAction)
  ecclesiastical_year ecclesiastical_years @relation(fields: [ecclesiastical_year_id], references: [year_id], onDelete: NoAction, onUpdate: NoAction)
  users               users                @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
  validator           users?               @relation("enrollment_validator", fields: [validated_by], references: [user_id], onDelete: NoAction, onUpdate: NoAction)

  investiture_history investiture_validation_history[]

  @@unique([user_id, class_id, ecclesiastical_year_id])
  @@index([user_id, ecclesiastical_year_id], map: "idx_enrollments_user_year")
  @@index([investiture_status], map: "idx_enrollments_status")
  @@index([locked_for_validation], map: "idx_enrollments_locked")
  @@index([user_id, cross_type_enrollment], map: "idx_enrollments_cross_type")
}

model error_logs {
  log_id             Int       @id @default(autoincrement())
  procedure_name     String    @db.VarChar(100)
  error_message      String
  additional_details String
  created_at         DateTime? @default(now()) @db.Timestamptz(6)
}

model finances {
  finance_id          Int                 @id @default(autoincrement())
  year                Int
  month               Int
  amount              Int
  description         String?
  club_type_id        Int
  finance_category_id Int
  finance_date        DateTime            @db.Date
  active              Boolean             @default(false)
  created_by          String              @db.Uuid
  created_at          DateTime?           @default(now()) @db.Timestamptz(6)
  modified_at         DateTime?           @default(now()) @db.Timestamptz(6)
  club_adv_id         Int?
  club_mg_id          Int?
  club_pathf_id       Int?
  club_adventurers    club_adventurers?   @relation(fields: [club_adv_id], references: [club_adv_id])
  club_master_guild   club_master_guilds? @relation(fields: [club_mg_id], references: [club_mg_id])
  club_pathfinders    club_pathfinders?   @relation(fields: [club_pathf_id], references: [club_pathf_id])
  club_types          club_types          @relation(fields: [club_type_id], references: [club_type_id], onDelete: NoAction, onUpdate: NoAction)
  users               users               @relation(fields: [created_by], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
  finances_categories finances_categories @relation(fields: [finance_category_id], references: [finance_category_id], onDelete: NoAction, onUpdate: NoAction)
}

model finances_categories {
  finance_category_id Int        @id @default(autoincrement())
  name                String     @db.VarChar(100)
  description         String?
  icon                Int?       @default(0)
  type                Int
  active              Boolean    @default(false)
  created_at          DateTime?  @default(now()) @db.Timestamptz(6)
  modified_at         DateTime?  @default(now()) @db.Timestamptz(6)
  finances            finances[]

  @@unique([name, type], map: "unique_name_type")
}

model folders {
  folder_id               Int                       @id @default(autoincrement())
  name                    String                    @unique @db.VarChar(255)
  description             String?
  active                  Boolean                   @default(false)
  created_at              DateTime?                 @default(now()) @db.Timestamptz(6)
  modified_at             DateTime?                 @default(now()) @db.Timestamptz(6)
  club_type               Int?
  ecclesiastical_year_id  Int?
  status                  String?                   @default("incompleto") @db.VarChar(50)
  total_points            Int?                      @default(0)
  max_points              Int?                      @default(0)
  minimum_points          Int?                      @default(0)
  assignments_folders     folder_assignments[]
  club_types              club_types?               @relation(fields: [club_type], references: [club_type_id], onDelete: NoAction, onUpdate: NoAction)
  ecclesiastical_year     ecclesiastical_years?     @relation(fields: [ecclesiastical_year_id], references: [year_id], onDelete: NoAction, onUpdate: NoAction)
  folders_modules         folders_modules[]
  folders_modules_records folders_modules_records[]
  folders_section_records folders_section_records[]
}

model folders_modules {
  folder_module_id        Int                       @id @default(autoincrement())
  name                    String                    @db.VarChar(255)
  description             String?
  folder_id               Int?
  total_points            Int?                      @default(0)
  max_points              Int?                      @default(0)
  minimum_points          Int?                      @default(0)
  active                  Boolean                   @default(true)
  created_at              DateTime?                 @default(now()) @db.Timestamptz(6)
  modified_at             DateTime?                 @default(now()) @db.Timestamptz(6)
  folders                 folders?                  @relation(fields: [folder_id], references: [folder_id], onDelete: NoAction, onUpdate: NoAction)
  folders_modules_records folders_modules_records[]
  folders_section_records folders_section_records[]
  folders_sections        folders_sections[]
}

model folders_modules_records {
  folder_module_record_id Int                 @id @default(autoincrement())
  folder_id               Int?
  module_id               Int?
  points                  Int?                @default(0)
  created_at              DateTime?           @default(now()) @db.Timestamptz(6)
  modified_at             DateTime?           @default(now()) @db.Timestamptz(6)
  club_adv_id             Int?
  club_mg_id              Int?
  club_pathf_id           Int?
  active                  Boolean             @default(true)
  club_adventurers        club_adventurers?   @relation(fields: [club_adv_id], references: [club_adv_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_act_club_adventurers")
  club_master_guild       club_master_guilds? @relation(fields: [club_mg_id], references: [club_mg_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_act_club_master_guild")
  club_pathfinders        club_pathfinders?   @relation(fields: [club_pathf_id], references: [club_pathf_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_act_club_pathfinders")
  folders                 folders?            @relation(fields: [folder_id], references: [folder_id], onDelete: NoAction, onUpdate: NoAction)
  folders_modules         folders_modules?    @relation(fields: [module_id], references: [folder_module_id], onDelete: NoAction, onUpdate: NoAction)
}

model folders_section_records {
  folder_section_record_id Int                 @id @default(autoincrement())
  folder_id                Int?
  module_id                Int?
  section_id               Int?
  points                   Int?                @default(0)
  pdf_file                 String?             @db.VarChar(255)
  created_at               DateTime?           @default(now()) @db.Timestamptz(6)
  modified_at              DateTime?           @default(now()) @db.Timestamptz(6)
  club_adv_id              Int?
  club_mg_id               Int?
  club_pathf_id            Int?
  evidences                Json?
  active                   Boolean             @default(true)
  club_adventurers         club_adventurers?   @relation(fields: [club_adv_id], references: [club_adv_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_act_club_adventurers")
  club_master_guild        club_master_guilds? @relation(fields: [club_mg_id], references: [club_mg_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_act_club_master_guild")
  club_pathfinders         club_pathfinders?   @relation(fields: [club_pathf_id], references: [club_pathf_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_act_club_pathfinders")
  folders                  folders?            @relation(fields: [folder_id], references: [folder_id], onDelete: NoAction, onUpdate: NoAction)
  folders_modules          folders_modules?    @relation(fields: [module_id], references: [folder_module_id], onDelete: NoAction, onUpdate: NoAction)
  folders_sections         folders_sections?   @relation(fields: [section_id], references: [folder_section_id], onDelete: NoAction, onUpdate: NoAction)
}

model folders_sections {
  folder_section_id       Int                       @id @default(autoincrement())
  name                    String                    @db.VarChar(255)
  description             String?
  module_id               Int?
  created_at              DateTime?                 @default(now()) @db.Timestamptz(6)
  modified_at             DateTime?                 @default(now()) @db.Timestamptz(6)
  total_points            Int?                      @default(0)
  max_points              Int?                      @default(0)
  minimum_points          Int?                      @default(0)
  active                  Boolean                   @default(true)
  folders_section_records folders_section_records[]
  folders_modules         folders_modules?          @relation(fields: [module_id], references: [folder_module_id], onDelete: NoAction, onUpdate: NoAction)
}

model honors {
  honor_id           Int               @id @default(autoincrement())
  name               String            @unique @db.VarChar(100)
  description        String?
  honor_image        String
  honors_category_id Int
  master_honors_id   Int?
  material_url       String            @db.VarChar
  club_type_id       Int
  active             Boolean           @default(true)
  approval           Int               @default(1)
  skill_level        Int               @default(1)
  year               String?           @db.VarChar
  created_at         DateTime          @default(now()) @db.Timestamptz(6)
  modified_at        DateTime?         @default(now()) @db.Timestamptz(6)
  club_types         club_types        @relation(fields: [club_type_id], references: [club_type_id], onDelete: NoAction, onUpdate: NoAction)
  honors_categories  honors_categories @relation(fields: [honors_category_id], references: [honor_category_id], onDelete: NoAction, onUpdate: NoAction)
  master_honors      master_honors?    @relation(fields: [master_honors_id], references: [master_honor_id], onDelete: NoAction, onUpdate: NoAction)
  users_honors       users_honors[]
}

model honors_categories {
  honor_category_id Int       @id @default(autoincrement())
  name              String    @unique @db.VarChar(100)
  description       String?
  icon              Int
  active            Boolean   @default(false)
  created_at        DateTime? @default(now()) @db.Timestamptz(6)
  modified_at       DateTime? @default(now()) @db.Timestamptz(6)
  honors            honors[]
}

model inventory_categories {
  inventory_category_id Int       @id @default(autoincrement())
  name                  String    @db.VarChar(100)
  icon                  Int?      @default(0)
  active                Boolean   @default(false)
  created_at            DateTime? @default(now()) @db.Timestamptz(6)
  modified_at           DateTime? @default(now()) @db.Timestamptz(6)
}

model local_camporees {
  local_camporee_id            Int                  @id @default(autoincrement())
  name                         String               @db.VarChar(255)
  description                  String?
  start_date                   DateTime             @db.Date
  end_date                     DateTime             @db.Date
  local_field_id               Int
  includes_adventurers         Boolean?             @default(false)
  includes_pathfinders         Boolean?             @default(false)
  includes_master_guides       Boolean?             @default(false)
  local_camporee_place         String               @default("Lugar")
  registration_cost            Decimal?             @db.Decimal(10, 2)
  ecclesiastical_year          Int
  active                       Boolean              @default(true)
  created_at                   DateTime             @default(now()) @db.Timestamptz(6)
  modified_at                  DateTime             @default(now()) @db.Timestamptz(6)
  attending_clubs_camporees    camporee_clubs[]
  attending_members_camporees  camporee_members[]
  ecclesiastical_year_relation ecclesiastical_years @relation("local_camporees_ecclesiastical_yearToecclesiastical_year", fields: [ecclesiastical_year], references: [year_id], onDelete: NoAction, onUpdate: NoAction)
  local_fields                 local_fields         @relation(fields: [local_field_id], references: [local_field_id], onDelete: NoAction, onUpdate: NoAction)
}

model local_fields {
  local_field_id              Int                           @id @default(autoincrement())
  name                        String                        @unique @db.VarChar(50)
  abbreviation                String                        @unique @db.VarChar(8)
  active                      Boolean                       @default(false)
  union_id                    Int
  created_at                  DateTime?                     @default(now()) @db.Timestamptz(6)
  modified_at                 DateTime?                     @default(now()) @db.Timestamptz(6)
  attending_clubs_camporees   camporee_clubs[]
  attending_members_camporees camporee_members[]
  clubs                       clubs[]
  districts                   districts[]
  local_camporees             local_camporees[]
  unions                      unions                        @relation(fields: [union_id], references: [union_id], onDelete: NoAction, onUpdate: NoAction)
  union_camporee_local_fields union_camporee_local_fields[]
  users                       users[]
  investiture_configs         investiture_config[]
}

model master_honors {
  master_honor_id Int       @id @default(autoincrement())
  name            String    @unique @db.VarChar(100)
  master_image    String?
  active          Boolean   @default(false)
  created_at      DateTime? @default(now()) @db.Timestamptz(6)
  modified_at     DateTime? @default(now()) @db.Timestamptz(6)
  honors          honors[]
}

model permissions {
  permission_id     String              @id @default(dbgenerated("extensions.uuid_generate_v4()")) @db.Uuid
  permission_name   String              @unique @db.VarChar(255)
  description       String?
  created_at        DateTime?           @default(now()) @db.Timestamptz(6)
  modified_at       DateTime?           @default(now()) @db.Timestamptz(6)
  active            Boolean             @default(true)
  role_permissions  role_permissions[]
  users_permissions users_permissions[]

  @@index([permission_name], map: "idx_permissions_name")
}

model role_permissions {
  role_permission_id String      @id @default(dbgenerated("extensions.uuid_generate_v4()")) @db.Uuid
  role_id            String      @db.Uuid
  permission_id      String      @db.Uuid
  created_at         DateTime?   @default(now()) @db.Timestamptz(6)
  modified_at        DateTime?   @default(now()) @db.Timestamptz(6)
  active             Boolean     @default(true)
  permissions        permissions @relation(fields: [permission_id], references: [permission_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_permission")
  roles              roles       @relation(fields: [role_id], references: [role_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_role")

  @@unique([role_id, permission_id])
  @@index([role_id], map: "idx_role_permissions_role_id")
}

model roles {
  role_id               String                  @id @default(dbgenerated("extensions.uuid_generate_v4()")) @db.Uuid
  role_name             String                  @unique @db.VarChar(255)
  created_at            DateTime?               @default(now()) @db.Timestamptz(6)
  modified_at           DateTime?               @default(now()) @db.Timestamptz(6)
  active                Boolean                 @default(true)
  role_category         role_category
  club_role_assignments club_role_assignments[]
  role_permissions      role_permissions[]
  users_roles           users_roles[]
}

model union_camporee_local_fields {
  union_camporee_lf_id Int
  local_field_id       Int
  created_at           DateTime        @default(now()) @db.Timestamptz(6)
  modified_at          DateTime        @default(now()) @db.Timestamptz(6)
  active               Boolean         @default(true)
  local_fields         local_fields    @relation(fields: [local_field_id], references: [local_field_id], onDelete: Cascade, onUpdate: NoAction)
  union_camporees      union_camporees @relation(fields: [union_camporee_lf_id], references: [union_camporee_id], onDelete: Cascade, onUpdate: NoAction)

  @@id([union_camporee_lf_id, local_field_id])
}

model union_camporees {
  union_camporee_id            Int                           @id @default(autoincrement())
  name                         String                        @db.VarChar(255)
  description                  String?
  start_date                   DateTime                      @db.Date
  end_date                     DateTime                      @db.Date
  union_id                     Int
  includes_adventurers         Boolean?                      @default(false)
  includes_pathfinders         Boolean?                      @default(false)
  includes_master_guides       Boolean?                      @default(false)
  union_camporee_place         String                        @default("Lugar")
  registration_cost            Decimal?                      @db.Decimal(10, 2)
  ecclesiastical_year          Int
  active                       Boolean                       @default(true)
  created_at                   DateTime                      @default(now()) @db.Timestamptz(6)
  modified_at                  DateTime                      @default(now()) @db.Timestamptz(6)
  union_camporee_local_fields  union_camporee_local_fields[]
  ecclesiastical_year_relation ecclesiastical_years          @relation("union_camporees_ecclesiastical_yearToecclesiastical_year", fields: [ecclesiastical_year], references: [year_id], onDelete: NoAction, onUpdate: NoAction)
  unions                       unions                        @relation(fields: [union_id], references: [union_id], onDelete: NoAction, onUpdate: NoAction)
}

model unions {
  union_id        Int               @id @default(autoincrement())
  name            String            @unique @db.VarChar(50)
  abbreviation    String            @unique @db.VarChar(8)
  active          Boolean           @default(false)
  country_id      Int
  created_at      DateTime?         @default(now()) @db.Timestamptz(6)
  modified_at     DateTime?         @default(now()) @db.Timestamptz(6)
  local_fields    local_fields[]
  union_camporees union_camporees[]
  countries       countries         @relation(fields: [country_id], references: [country_id], onDelete: NoAction, onUpdate: NoAction)
  users           users[]
}

model unit_members {
  unit_member_id Int      @id @default(autoincrement())
  unit_id        Int
  user_id        String   @unique @db.Uuid
  created_at     DateTime @default(now()) @db.Timestamptz(6)
  modified_at    DateTime @default(now()) @db.Timestamptz(6)
  active         Boolean  @default(true)
  units          units    @relation(fields: [unit_id], references: [unit_id], onDelete: NoAction, onUpdate: NoAction)
  users          users    @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
}

model units {
  unit_id                           Int                 @id @default(autoincrement())
  name                              String              @db.VarChar(255)
  captain_id                        String              @db.Uuid
  secretary_id                      String              @db.Uuid
  advisor_id                        String              @db.Uuid
  substitute_advisor_id             String?             @db.Uuid
  club_type_id                      Int
  active                            Boolean
  created_at                        DateTime            @default(now()) @db.Timestamptz(6)
  modified_at                       DateTime            @default(now()) @db.Timestamptz(6)
  club_adv_id                       Int?
  club_mg_id                        Int?
  club_pathf_id                     Int?
  unit_members                      unit_members[]
  club_adventurers                  club_adventurers?   @relation(fields: [club_adv_id], references: [club_adv_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_act_club_adventurers")
  club_master_guild                 club_master_guilds? @relation(fields: [club_mg_id], references: [club_mg_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_act_club_master_guild")
  club_pathfinders                  club_pathfinders?   @relation(fields: [club_pathf_id], references: [club_pathf_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_act_club_pathfinders")
  users_units_advisor_idTousers     users               @relation("units_advisor_idTousers", fields: [advisor_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
  users_units_captain_idTousers     users               @relation("units_captain_idTousers", fields: [captain_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
  club_types                        club_types          @relation(fields: [club_type_id], references: [club_type_id], onDelete: NoAction, onUpdate: NoAction)
  users_units_secretary_idTousers   users               @relation("units_secretary_idTousers", fields: [secretary_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
  users_units_as_substitute_advisor users?              @relation("units_substitute_advisor_idTousers", fields: [substitute_advisor_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
}

model users {
  user_id                        String                           @id @default(dbgenerated("auth.uid()")) @db.Uuid
  name                           String?                          @db.VarChar(50)
  paternal_last_name             String?                          @db.VarChar(50)
  maternal_last_name             String?                          @db.VarChar(50)
  active                         Boolean                          @default(true)
  email                          String                           @unique @db.VarChar(100)
  gender                         String?                          @db.VarChar
  birthday                       DateTime?                        @db.Date
  blood                          blood_type?
  baptism                        Boolean                          @default(false)
  baptism_date                   DateTime?                        @db.Date
  apple_connected                Boolean                          @default(false)
  fb_connected                   Boolean                          @default(false)
  google_connected               Boolean                          @default(false)
  user_image                     String?
  country_id                     Int?
  union_id                       Int?
  access_app                     Boolean?                         @default(true)
  access_panel                   Boolean?                         @default(false)
  created_at                     DateTime                         @default(now()) @db.Timestamptz(6)
  modified_at                    DateTime                         @default(now()) @updatedAt @db.Timestamptz(6)
  local_field_id                 Int?
  activities                     activities[]
  assignments_folders            folder_assignments[]
  attending_members_camporees    camporee_members[]
  class_module_progress          class_module_progress[]
  class_section_progress         class_section_progress[]
  club_role_assignments          club_role_assignments[]
  emergency_contacts             emergency_contacts[]             @relation("internal_user_emergency_contact")
  emergency_contact              emergency_contacts[]             @relation("user_emergency_contact")
  enrollments                    enrollments[]
  finances                       finances[]
  unit_members                   unit_members?
  units_advisor_id               units[]                          @relation("units_advisor_idTousers")
  units_captain_id               units[]                          @relation("units_captain_idTousers")
  units_secretary_id             units[]                          @relation("units_secretary_idTousers")
  units_as_substitute_advisor    units[]                          @relation("units_substitute_advisor_idTousers")
  countries                      countries?                       @relation(fields: [country_id], references: [country_id], onDelete: NoAction, onUpdate: NoAction)
  local_fields                   local_fields?                    @relation(fields: [local_field_id], references: [local_field_id], onDelete: NoAction, onUpdate: NoAction)
  unions                         unions?                          @relation(fields: [union_id], references: [union_id], onDelete: NoAction, onUpdate: NoAction)
  users_allergies                users_allergies[]
  users_classes                  users_classes[]
  users_diseases                 users_diseases[]
  users_honors                   users_honors[]
  users_permissions              users_permissions[]
  users_pr                       users_pr[]
  users_roles                    users_roles[]
  weekly_records                 weekly_records[]
  validator_enrollments          enrollments[]                    @relation("enrollment_validator")
  users_certifications           users_certifications[]
  certification_module_progress  certification_module_progress[]
  certification_section_progress certification_section_progress[]
  member_insurances              member_insurances[]
  investiture_validation_history investiture_validation_history[]
  legal_representative           legal_representatives?           @relation("user_legal_rep")
  as_legal_representative        legal_representatives[]          @relation("representative")
}

model users_pr {
  user_pr_id Int    @id @default(autoincrement())
  user_id    String @unique @db.Uuid

  // Tracking granular
  complete                 Boolean @default(false)
  profile_picture_complete Boolean @default(false)
  personal_info_complete   Boolean @default(false)
  club_selection_complete  Boolean @default(false)

  date_completed DateTime? @db.Timestamptz(6)
  created_at     DateTime  @default(now()) @db.Timestamptz(6)
  modified_at    DateTime  @default(now()) @updatedAt @db.Timestamptz(6)

  users users @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)
}

model users_classes {
  user_class_id    Int       @id @default(autoincrement())
  user_id          String    @db.Uuid
  class_id         Int
  investiture      Boolean   @default(false)
  date_investiture DateTime? @db.Date
  active           Boolean   @default(true)
  created_at       DateTime  @default(now()) @db.Timestamptz(6)
  modified_at      DateTime  @default(now()) @updatedAt @db.Timestamptz(6)
  advanced         Boolean   @default(false)
  certificate      String?   @db.VarChar
  current_class    Boolean   @default(false)
  classes          classes   @relation(fields: [class_id], references: [class_id], onDelete: SetNull)
  users            users     @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([user_id, class_id])
}

model certifications {
  certification_id Int      @id @default(autoincrement())
  name             String   @unique @db.VarChar(255)
  description      String?
  material_url     String?  @db.VarChar
  active           Boolean  @default(true)
  created_at       DateTime @default(now()) @db.Timestamptz(6)
  modified_at      DateTime @default(now()) @updatedAt @db.Timestamptz(6)

  certification_modules          certification_modules[]
  users_certifications           users_certifications[]
  certification_module_progress  certification_module_progress[]
  certification_section_progress certification_section_progress[]
}

model certification_modules {
  module_id        Int      @id @default(autoincrement())
  name             String   @db.VarChar(255)
  description      String?
  certification_id Int
  active           Boolean  @default(true)
  created_at       DateTime @default(now()) @db.Timestamptz(6)
  modified_at      DateTime @default(now()) @updatedAt @db.Timestamptz(6)

  certifications         certifications           @relation(fields: [certification_id], references: [certification_id], onDelete: NoAction, onUpdate: NoAction)
  certification_sections certification_sections[]

  @@unique([name, certification_id])
}

model certification_sections {
  section_id  Int      @id @default(autoincrement())
  name        String   @db.VarChar(255)
  description String?
  module_id   Int
  active      Boolean  @default(true)
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  modified_at DateTime @default(now()) @updatedAt @db.Timestamptz(6)

  certification_modules certification_modules @relation(fields: [module_id], references: [module_id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([name, module_id])
}

model users_certifications {
  enrollment_id     Int       @id @default(autoincrement())
  user_id           String    @db.Uuid
  certification_id  Int
  enrollment_date   DateTime  @default(now()) @db.Timestamptz(6)
  completion_status Boolean   @default(false)
  completion_date   DateTime? @db.Timestamptz(6)
  certificate_url   String?   @db.VarChar
  active            Boolean   @default(true)
  created_at        DateTime  @default(now()) @db.Timestamptz(6)
  modified_at       DateTime  @default(now()) @updatedAt @db.Timestamptz(6)

  certifications certifications @relation(fields: [certification_id], references: [certification_id], onDelete: NoAction, onUpdate: NoAction)
  users          users          @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)

  @@index([user_id, completion_status], map: "idx_users_certifications_completion")
}

model certification_module_progress {
  progress_id      Int      @id @default(autoincrement())
  user_id          String   @db.Uuid
  certification_id Int
  module_id        Int
  score            Float
  active           Boolean  @default(true)
  created_at       DateTime @default(now()) @db.Timestamptz(6)
  modified_at      DateTime @default(now()) @updatedAt @db.Timestamptz(6)

  certifications certifications @relation(fields: [certification_id], references: [certification_id], onDelete: NoAction, onUpdate: NoAction)
  users          users          @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([user_id, certification_id, module_id])
}

model certification_section_progress {
  progress_id      Int      @id @default(autoincrement())
  user_id          String   @db.Uuid
  certification_id Int
  module_id        Int
  section_id       Int
  score            Float
  evidences        Json?
  active           Boolean  @default(true)
  created_at       DateTime @default(now()) @db.Timestamptz(6)
  modified_at      DateTime @default(now()) @updatedAt @db.Timestamptz(6)

  certifications certifications @relation(fields: [certification_id], references: [certification_id], onDelete: NoAction, onUpdate: NoAction)
  users          users          @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([user_id, certification_id, module_id, section_id])
}

model member_insurances {
  insurance_id    Int                 @id @default(autoincrement())
  user_id         String              @db.Uuid
  insurance_type  insurance_type_enum
  policy_number   String?             @db.VarChar(100)
  provider        String?             @db.VarChar(255)
  start_date      DateTime            @db.Date
  end_date        DateTime            @db.Date
  coverage_amount Decimal?            @db.Decimal(10, 2)
  active          Boolean             @default(true)
  created_at      DateTime            @default(now()) @db.Timestamptz(6)
  modified_at     DateTime            @default(now()) @updatedAt @db.Timestamptz(6)

  users             users              @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)
  attending_members camporee_members[]

  @@index([user_id, end_date], map: "idx_member_insurances_user_expiry")
}

model investiture_validation_history {
  history_id    Int                     @id @default(autoincrement())
  enrollment_id Int
  action        investiture_action_enum
  performed_by  String                  @db.Uuid
  comments      String?
  created_at    DateTime                @default(now()) @db.Timestamptz(6)

  enrollments enrollments @relation(fields: [enrollment_id], references: [enrollment_id], onDelete: Cascade, onUpdate: NoAction)
  users       users       @relation(fields: [performed_by], references: [user_id], onDelete: NoAction, onUpdate: NoAction)

  @@index([enrollment_id], map: "idx_investiture_history_enrollment")
}

model investiture_config {
  config_id              Int      @id @default(autoincrement())
  local_field_id         Int
  ecclesiastical_year_id Int
  submission_deadline    DateTime @db.Date
  investiture_date       DateTime @db.Date
  active                 Boolean  @default(true)
  created_at             DateTime @default(now()) @db.Timestamptz(6)
  modified_at            DateTime @default(now()) @updatedAt @db.Timestamptz(6)

  local_fields        local_fields         @relation(fields: [local_field_id], references: [local_field_id], onDelete: Cascade, onUpdate: NoAction)
  ecclesiastical_year ecclesiastical_years @relation(fields: [ecclesiastical_year_id], references: [year_id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([local_field_id, ecclesiastical_year_id])
}

model diseases {
  disease_id     Int              @id @default(autoincrement())
  name           String           @unique
  description    String?
  created_at     DateTime         @default(now()) @db.Timestamptz(6)
  modified_at    DateTime         @default(now()) @updatedAt @db.Timestamptz(6)
  active         Boolean          @default(true)
  users_diseases users_diseases[]
}

model allergies {
  allergy_id      Int               @id @default(autoincrement())
  name            String            @unique
  description     String?
  created_at      DateTime          @default(now()) @db.Timestamptz(6)
  modified_at     DateTime          @default(now()) @updatedAt @db.Timestamptz(6)
  active          Boolean           @default(true)
  users_allergies users_allergies[]
}

model emergency_contacts {
  emergency_id      Int      @id @default(autoincrement())
  name              String
  relationship_type Int
  primary           Boolean  @default(false)
  created_at        DateTime @default(now()) @db.Timestamptz(6)
  modified_at       DateTime @default(now()) @updatedAt @db.Timestamptz(6)
  owner_id          String   @db.Uuid
  contact_user_id   String?  @db.Uuid
  active            Boolean  @default(true)
  phone             String   @db.VarChar

  contact_user users? @relation("internal_user_emergency_contact", fields: [contact_user_id], references: [user_id])
  owner        users  @relation("user_emergency_contact", fields: [owner_id], references: [user_id])
}

model weekly_records {
  record_id   Int      @id @default(autoincrement())
  user_id     String   @db.Uuid
  week        Int
  attendance  Int
  punctuality Int
  points      Int
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  modified_at DateTime @default(now()) @db.Timestamptz(6)
  active      Boolean  @default(true)
  users       users    @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([user_id, week])
}

model users_allergies {
  user_allergies_id Int        @id(map: "user_allergies_pkey") @default(autoincrement())
  user_id           String     @db.Uuid
  allergy_id        Int?
  created_at        DateTime   @default(now()) @db.Timestamptz(6)
  modified_at       DateTime   @default(now()) @db.Timestamptz(6)
  active            Boolean    @default(true)
  allergies         allergies? @relation(fields: [allergy_id], references: [allergy_id], map: "user_allergies_allergy_id_fkey")
  users             users      @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction, map: "user_allergies_user_id_fkey")

  @@unique([user_id, allergy_id], map: "user_allergies_user_id_allergy_id_key")
}

model users_diseases {
  user_disease_id Int      @id(map: "user_diseases_pkey") @default(autoincrement())
  user_id         String   @db.Uuid
  disease_id      Int
  created_at      DateTime @default(now()) @db.Timestamptz(6)
  modified_at     DateTime @default(now()) @db.Timestamptz(6)
  active          Boolean  @default(true)
  diseases        diseases @relation(fields: [disease_id], references: [disease_id], onDelete: NoAction, onUpdate: NoAction, map: "user_diseases_disease_id_fkey")
  users           users    @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction, map: "user_diseases_user_id_fkey")

  @@unique([user_id, disease_id], map: "user_diseases_user_id_disease_id_key")
}

model users_honors {
  user_honor_id Int       @id(map: "user_honors_pkey") @default(autoincrement())
  user_id       String    @db.Uuid
  honor_id      Int
  active        Boolean   @default(true)
  validate      Boolean   @default(false)
  certificate   String    @db.VarChar
  images        Json      @default("[]")
  document      String?   @db.VarChar
  date          DateTime  @db.Date
  created_at    DateTime? @default(now()) @db.Timestamptz(6)
  modified_at   DateTime? @default(now()) @db.Timestamptz(6)
  honors        honors    @relation(fields: [honor_id], references: [honor_id], onDelete: NoAction, onUpdate: NoAction, map: "user_honors_honor_id_fkey")
  users         users     @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction, map: "user_honors_user_id_fkey")
}

model users_permissions {
  user_permission_id String      @id(map: "user_permissions_pkey") @default(dbgenerated("extensions.uuid_generate_v4()")) @db.Uuid
  user_id            String      @db.Uuid
  permission_id      String      @db.Uuid
  created_at         DateTime?   @default(now()) @db.Timestamptz(6)
  modified_at        DateTime?   @default(now()) @db.Timestamptz(6)
  active             Boolean     @default(true)
  permissions        permissions @relation(fields: [permission_id], references: [permission_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_permission")
  users              users       @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_user")

  @@unique([user_id, permission_id], map: "user_permissions_user_id_permission_id_key")
}

model users_roles {
  user_role_id String    @id(map: "user_roles_pkey") @default(dbgenerated("extensions.uuid_generate_v4()")) @db.Uuid
  user_id      String    @db.Uuid
  role_id      String    @db.Uuid
  created_at   DateTime? @default(now()) @db.Timestamptz(6)
  modified_at  DateTime? @default(now()) @db.Timestamptz(6)
  active       Boolean   @default(true)
  roles        roles     @relation(fields: [role_id], references: [role_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_role")
  users        users     @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_user")

  @@unique([user_id, role_id], map: "user_roles_user_id_role_id_key")
  @@index([user_id], map: "idx_users_roles_user_id")
}

model medicines {
  medicine_id Int       @id @default(autoincrement())
  name        String    @db.VarChar
  description String?   @db.VarChar
  active      Boolean?  @default(true)
  created_at  DateTime  @default(now()) @db.Timestamptz(6)
  modified_at DateTime? @default(now()) @db.Timestamptz(6)
}

// ========================================
// NUEVAS TABLAS V2 - Decisiones Finales
// ========================================

model relationship_types {
  relationship_type_id String   @id @default(dbgenerated("extensions.uuid_generate_v4()")) @db.Uuid
  name                 String   @unique @db.VarChar(50)
  description          String?
  active               Boolean  @default(true)
  created_at           DateTime @default(now()) @db.Timestamptz(6)
  modified_at          DateTime @default(now()) @updatedAt @db.Timestamptz(6)

  legal_representatives legal_representatives[]

  @@index([name], map: "idx_relationship_types_name")
}

model legal_representatives {
  id      String @id @default(dbgenerated("extensions.uuid_generate_v4()")) @db.Uuid
  user_id String @unique @db.Uuid

  // Opci√≥n 1: Representante es usuario registrado
  representative_user_id String? @db.Uuid

  // Opci√≥n 2: Solo datos del representante
  name               String? @db.VarChar(100)
  paternal_last_name String? @db.VarChar(100)
  maternal_last_name String? @db.VarChar(100)
  phone              String? @db.VarChar(20)

  // Tipo de relaci√≥n
  relationship_type_id String? @db.Uuid

  created_at  DateTime @default(now()) @db.Timestamptz(6)
  modified_at DateTime @default(now()) @updatedAt @db.Timestamptz(6)

  // Relaciones
  users               users               @relation("user_legal_rep", fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)
  representative_user users?              @relation("representative", fields: [representative_user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
  relationship_types  relationship_types? @relation(fields: [relationship_type_id], references: [relationship_type_id], onDelete: NoAction, onUpdate: NoAction)

  @@index([user_id], map: "idx_legal_reps_user")
  @@index([representative_user_id], map: "idx_legal_reps_representative")
}

enum blood_type {
  A_POSITIVE  @map("A+")
  A_NEGATIVE  @map("A-")
  B_POSITIVE  @map("B+")
  B_NEGATIVE  @map("B-")
  AB_POSITIVE @map("AB+")
  AB_NEGATIVE @map("AB-")
  O_POSITIVE  @map("O+")
  O_NEGATIVE  @map("O-")
}

enum gender {
  Masculino
  Femenino
}

enum role_category {
  GLOBAL
  CLUB
}

enum investiture_status_enum {
  IN_PROGRESS
  SUBMITTED_FOR_VALIDATION
  APPROVED
  REJECTED
  INVESTIDO
}

enum investiture_action_enum {
  SUBMITTED
  APPROVED
  REJECTED
  REINVESTITURE_REQUESTED
}

enum insurance_type_enum {
  GENERAL_ACTIVITIES
  CAMPOREE
  HIGH_RISK
}

enum evidence_validation_enum {
  PENDING
  VALIDATED
  REJECTED
}
